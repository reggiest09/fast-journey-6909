!function(e){"use strict";function t(t,s){this.itemsArray=[],this.$element=e(t),this.$element.hide(),this.isSelect="SELECT"===t.tagName,this.multiple=this.isSelect&&t.hasAttribute("multiple"),this.objectItems=s&&s.itemValue,this.placeholderText=t.hasAttribute("placeholder")?this.$element.attr("placeholder"):"",this.inputSize=Math.max(1,this.placeholderText.length),this.$container=e('<div class="bootstrap-tagsinput"></div>'),this.$input=e('<input type="text" placeholder="'+this.placeholderText+'"/>').appendTo(this.$container),this.$element.before(this.$container),this.build(s)}function s(e,t){if("function"!=typeof e[t]){var s=e[t];e[t]=function(e){return e[s]}}}function n(e,t){if("function"!=typeof e[t]){var s=e[t];e[t]=function(){return s}}}function i(e){return e?c.text(e).html():""}function r(e){var t=0;if(document.selection){e.focus();var s=document.selection.createRange();s.moveStart("character",-e.value.length),t=s.text.length}else(e.selectionStart||"0"==e.selectionStart)&&(t=e.selectionStart);return t}function a(t,s){var n=!1;return e.each(s,function(e,s){if("number"==typeof s&&t.which===s)return n=!0,!1;if(t.which===s.which){var i=!s.hasOwnProperty("altKey")||t.altKey===s.altKey,r=!s.hasOwnProperty("shiftKey")||t.shiftKey===s.shiftKey,a=!s.hasOwnProperty("ctrlKey")||t.ctrlKey===s.ctrlKey;if(i&&r&&a)return n=!0,!1}}),n}var o={tagClass:function(){return"label label-info"},itemValue:function(e){return e?e.toString():e},itemText:function(e){return this.itemValue(e)},itemTitle:function(){return null},freeInput:!0,addOnBlur:!0,maxTags:void 0,maxChars:void 0,confirmKeys:[13,44],delimiter:",",delimiterRegex:null,cancelConfirmKeysOnEmpty:!0,onTagExists:function(e,t){t.hide().fadeIn()},trimValue:!1,allowDuplicates:!1};t.prototype={constructor:t,add:function(t,s,n){var r=this;if(!(r.options.maxTags&&r.itemsArray.length>=r.options.maxTags)&&(t===!1||t)){if("string"==typeof t&&r.options.trimValue&&(t=e.trim(t)),"object"==typeof t&&!r.objectItems)throw"Can't add objects when itemValue option is not set";if(!t.toString().match(/^\s*$/)){if(r.isSelect&&!r.multiple&&r.itemsArray.length>0&&r.remove(r.itemsArray[0]),"string"==typeof t&&"INPUT"===this.$element[0].tagName){var a=r.options.delimiterRegex?r.options.delimiterRegex:r.options.delimiter,o=t.split(a);if(o.length>1){for(var c=0;c<o.length;c++)this.add(o[c],!0);return void(s||r.pushVal())}}var l=r.options.itemValue(t),u=r.options.itemText(t),p=r.options.tagClass(t),m=r.options.itemTitle(t),d=e.grep(r.itemsArray,function(e){return r.options.itemValue(e)===l})[0];if(!d||r.options.allowDuplicates){if(!(r.items().toString().length+t.length+1>r.options.maxInputLength)){var h=e.Event("beforeItemAdd",{item:t,cancel:!1,options:n});if(r.$element.trigger(h),!h.cancel){r.itemsArray.push(t);var f=e('<span class="tag '+i(p)+(null!==m?'" title="'+m:"")+'">'+i(u)+'<span data-role="remove"></span></span>');if(f.data("item",t),r.findInputWrapper().before(f),f.after(" "),r.isSelect&&!e('option[value="'+encodeURIComponent(l)+'"]',r.$element)[0]){var v=e("<option selected>"+i(u)+"</option>");v.data("item",t),v.attr("value",l),r.$element.append(v)}s||r.pushVal(),r.options.maxTags!==r.itemsArray.length&&r.items().toString().length!==r.options.maxInputLength||r.$container.addClass("bootstrap-tagsinput-max"),r.$element.trigger(e.Event("itemAdded",{item:t,options:n}))}}}else if(r.options.onTagExists){var g=e(".tag",r.$container).filter(function(){return e(this).data("item")===d});r.options.onTagExists(t,g)}}}},remove:function(t,s,n){var i=this;if(i.objectItems&&(t="object"==typeof t?e.grep(i.itemsArray,function(e){return i.options.itemValue(e)==i.options.itemValue(t)}):e.grep(i.itemsArray,function(e){return i.options.itemValue(e)==t}),t=t[t.length-1]),t){var r=e.Event("beforeItemRemove",{item:t,cancel:!1,options:n});if(i.$element.trigger(r),r.cancel)return;e(".tag",i.$container).filter(function(){return e(this).data("item")===t}).remove(),e("option",i.$element).filter(function(){return e(this).data("item")===t}).remove(),e.inArray(t,i.itemsArray)!==-1&&i.itemsArray.splice(e.inArray(t,i.itemsArray),1)}s||i.pushVal(),i.options.maxTags>i.itemsArray.length&&i.$container.removeClass("bootstrap-tagsinput-max"),i.$element.trigger(e.Event("itemRemoved",{item:t,options:n}))},removeAll:function(){var t=this;for(e(".tag",t.$container).remove(),e("option",t.$element).remove();t.itemsArray.length>0;)t.itemsArray.pop();t.pushVal()},refresh:function(){var t=this;e(".tag",t.$container).each(function(){var s=e(this),n=s.data("item"),r=t.options.itemValue(n),a=t.options.itemText(n),o=t.options.tagClass(n);if(s.attr("class",null),s.addClass("tag "+i(o)),s.contents().filter(function(){return 3==this.nodeType})[0].nodeValue=i(a),t.isSelect){var c=e("option",t.$element).filter(function(){return e(this).data("item")===n});c.attr("value",r)}})},items:function(){return this.itemsArray},pushVal:function(){var t=this,s=e.map(t.items(),function(e){return t.options.itemValue(e).toString()});t.$element.val(s,!0).trigger("change")},build:function(t){var i=this;if(i.options=e.extend({},o,t),i.objectItems&&(i.options.freeInput=!1),s(i.options,"itemValue"),s(i.options,"itemText"),n(i.options,"tagClass"),i.options.typeahead){var c=i.options.typeahead||{};n(c,"source"),i.$input.typeahead(e.extend({},c,{source:function(t,s){function n(e){for(var t=[],n=0;n<e.length;n++){var a=i.options.itemText(e[n]);r[a]=e[n],t.push(a)}s(t)}this.map={};var r=this.map,a=c.source(t);e.isFunction(a.success)?a.success(n):e.isFunction(a.then)?a.then(n):e.when(a).then(n)},updater:function(e){return i.add(this.map[e]),this.map[e]},matcher:function(e){return e.toLowerCase().indexOf(this.query.trim().toLowerCase())!==-1},sorter:function(e){return e.sort()},highlighter:function(e){var t=new RegExp("("+this.query+")","gi");return e.replace(t,"<strong>$1</strong>")}}))}if(i.options.typeaheadjs){var l=null,u={},p=i.options.typeaheadjs;e.isArray(p)?(l=p[0],u=p[1]):u=p,i.$input.typeahead(l,u).on("typeahead:selected",e.proxy(function(e,t){u.valueKey?i.add(t[u.valueKey]):i.add(t),i.$input.typeahead("val","")},i))}i.$container.on("click",e.proxy(function(){i.$element.attr("disabled")||i.$input.removeAttr("disabled"),i.$input.focus()},i)),i.options.addOnBlur&&i.options.freeInput&&i.$input.on("focusout",e.proxy(function(){0===e(".typeahead, .twitter-typeahead",i.$container).length&&(i.add(i.$input.val()),i.$input.val(""))},i)),i.$container.on("keydown","input",e.proxy(function(t){var s=e(t.target),n=i.findInputWrapper();if(i.$element.attr("disabled"))return void i.$input.attr("disabled","disabled");switch(t.which){case 8:if(0===r(s[0])){var a=n.prev();a.length&&i.remove(a.data("item"))}break;case 46:if(0===r(s[0])){var o=n.next();o.length&&i.remove(o.data("item"))}break;case 37:var c=n.prev();0===s.val().length&&c[0]&&(c.before(n),s.focus());break;case 39:var l=n.next();0===s.val().length&&l[0]&&(l.after(n),s.focus())}var u=s.val().length;Math.ceil(u/5);s.attr("size",Math.max(this.inputSize,s.val().length))},i)),i.$container.on("keypress","input",e.proxy(function(t){var s=e(t.target);if(i.$element.attr("disabled"))return void i.$input.attr("disabled","disabled");var n=s.val(),r=i.options.maxChars&&n.length>=i.options.maxChars;i.options.freeInput&&(a(t,i.options.confirmKeys)||r)&&(0!==n.length&&(i.add(r?n.substr(0,i.options.maxChars):n),s.val("")),i.options.cancelConfirmKeysOnEmpty===!1&&t.preventDefault());var o=s.val().length;Math.ceil(o/5);s.attr("size",Math.max(this.inputSize,s.val().length))},i)),i.$container.on("click","[data-role=remove]",e.proxy(function(t){i.$element.attr("disabled")||i.remove(e(t.target).closest(".tag").data("item"))},i)),i.options.itemValue===o.itemValue&&("INPUT"===i.$element[0].tagName?i.add(i.$element.val()):e("option",i.$element).each(function(){i.add(e(this).attr("value"),!0)}))},destroy:function(){var e=this;e.$container.off("keypress","input"),e.$container.off("click","[role=remove]"),e.$container.remove(),e.$element.removeData("tagsinput"),e.$element.show()},focus:function(){this.$input.focus()},input:function(){return this.$input},findInputWrapper:function(){for(var t=this.$input[0],s=this.$container[0];t&&t.parentNode!==s;)t=t.parentNode;return e(t)}},e.fn.tagsinput=function(s,n,i){var r=[];return this.each(function(){var a=e(this).data("tagsinput");if(a)if(s||n){if(void 0!==a[s]){if(3===a[s].length&&void 0!==i)var o=a[s](n,null,i);else var o=a[s](n);void 0!==o&&r.push(o)}}else r.push(a);else a=new t(this,s),e(this).data("tagsinput",a),r.push(a),"SELECT"===this.tagName&&e("option",e(this)).attr("selected","selected"),e(this).val(e(this).val())}),"string"==typeof s?r.length>1?r:r[0]:r},e.fn.tagsinput.Constructor=t;var c=e("<div />");e(function(){e("input[data-role=tagsinput], select[multiple][data-role=tagsinput]").tagsinput()})}(window.jQuery);